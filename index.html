<!DOCTYPE html>
<html lang="zh">
 <head>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta charset="utf-8"/>
  <title>
   AI旅行助手（优化版）
  </title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js">
  </script>
  <style>
   body {
  font-family: "Microsoft YaHei", sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f6f7;
}
.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px 16px;
}
h2 {
  text-align: center;
  font-size: 30px;
  margin-bottom: 24px;
  font-weight: bold;
  color: #2a2a2a;
  letter-spacing: 1px;
}
textarea {
  width: 100%;
  font-size: 20px;
  padding: 18px;
  border-radius: 12px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  height: 30vh;
  background-color: white;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

button {
  display: block;
  width: 60%;
  font-size: 22px;
  padding: 16px;
  margin: 20px auto;
  background: linear-gradient(to right, #4CAF50, #2e7d32);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  transition: transform 0.1s ease, box-shadow 0.2s ease;
}
button:hover {
  transform: translateY(1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}
#pdfButton {
  display: none;
  background-color: #2196F3;
}

.output {
  background-color: #ffffff;
  border-radius: 16px;
  padding: 24px;
  margin-top: 30px;
  font-size: 18px;
  line-height: 1.7;
  box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 14px;
  font-size: 16px;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.paywall {
  text-align: center;
  border: 1px solid #ccc;
  padding: 15px;
  background-color: #fffbe8;
  border-radius: 10px;
  margin-top: 20px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.paywall img {
  max-width: 200px;
  margin: 10px auto;
  display: block;
}
.paywall button {
  background-color: #e0e0e0;
  font-size: 16px;
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 10px;
}

/* 手机端优化 */
@media (max-width: 768px) {
  h2 {
    font-size: 28px;
  }
  textarea {
    font-size: 20px;
    height: 32vh;
  }
  button {
    font-size: 24px;
    width: 85%;
    padding: 16px;
  }
  .output {
    font-size: 18.5px;
    padding: 26px;
  }
}
  

/* PDF 输出样式优化 */
@media print {
  body {
    -webkit-print-color-adjust: exact;
  }
  .output {
    font-size: 16px;
    line-height: 1.7;
    padding: 24px;
    color: #000;
    background: #fff !important;
  }
  table {
    width: 100%;
    font-size: 15px;
    border-collapse: collapse;
    margin-top: 16px;
  }
  table th, table td {
    border: 1px solid #aaa;
    padding: 8px;
  }
}
  

/* 转圈加载动画 */
.spinner {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px auto;
  height: 40px;
}
.spinner::after {
  content: "";
  width: 32px;
  height: 32px;
  border: 4px solid #ccc;
  border-top-color: #4CAF50;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* 按钮美化 */
button {
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 16px auto;
  display: block;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 18px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
button:hover {
  background-color: #45a049;
}
button:active {
  transform: scale(0.97);
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
  

/* 页脚版权信息居中显示在页面底部 */
footer {
  text-align: center;
  font-size: 14px;
  color: #888;
  margin-top: 40px;
  margin-bottom: 20px;
}

/* 修复 PDF 按钮居中失败的问题 */
#pdfButton {
  display: none;
  margin: 24px auto;
  text-align: center;
  width: fit-content;
}
  </style>
 </head>
 <body>
  <div class="container">
   <h2 style="margin-top: 10px;">
    ✈️ AI旅行助手（优化版）
   </h2>
   <textarea id="inputText" placeholder="请输入您的旅行需求，例如：东京到大阪6天自由行，3人，8月中旬，人均预算10000元" rows="7"></textarea>
   <button id="generateBtn" onclick="generate()">
    🗺️ AI生成旅游行程
   </button>
   <div class="output" id="pdf-content">
    <div id="output">
     <p>
      <strong>
       这里将显示生成的行程内容...
      </strong>
     </p>
    </div>
   </div>
   <div class="paywall" id="paywall" style="display:none;">
    <p>
     <strong>
      🔒 如需下载行程PDF，请扫码支付 &yen;10 后，点击下方按钮：
     </strong>
    </p>
    <img alt="微信支付二维码" src="./wechat_qr.png"/>
    <button id="unlockButton" onclick="unlockPDF()">
     <span>
      ☐
     </span>
     我已支付，下载行程PDF
    </button>
   </div>
   <div style="text-align: center;">
    <button id="pdfButton" onclick="exportPDF()" style="display: none;">
     📄 下载行程PDF文件
    </button>
   </div>
   <script>
    async function generate() {
      const userInput = document.getElementById('inputText').value.trim();
      if (!userInput) {
        alert("⚠️ 请输入您的旅行需求！");
        return;
      }

      const output = document.getElementById('output');
      const paywall = document.getElementById('paywall');
      const pdfButton = document.getElementById('pdfButton');
      const generateBtn = document.getElementById('generateBtn');

      output.innerHTML = '<p><strong>⏳ AI正在生成行程，请稍等大概30秒...</strong></p>';
      paywall.style.display = 'none';
      pdfButton.style.display = 'none';
      generateBtn.disabled = true;
      generateBtn.innerText = "🗺️ AI生成旅游行程";

      const prompt = `你是一位专业的中文旅行规划师，请根据以下旅行者的需求，制定详细的日本自由行计划。旅行需求：${userInput}。
      
请为这次日本自由行提供以下内容：

---

### 1. 每日详细行程（按 Day1 ~ DayX 划分）：

- 城市/地区名称  
- 推荐景点（人文、自然、文化类）  
- 推荐交通方式（比如电车，新干线，出租车，也可以推荐包车自由行）
- 餐饮推荐（特色美食或区域料理）  
- 推荐住宿区域（交通便利，适合家庭）  
- 节奏合理，适合中年人及青少年，不宜过于紧张

---

### 2. 每日预算估算（简要列出每人/家庭单位估算）：

- 交通费用  
- 餐饮费用  
- 门票费用  
- 住宿费用  
- 其他小费/自由活动支出

---

### 3. 输出格式请使用以下 **Markdown 表格** 的每日行程，方便用户查看与导出为PDF，并注意分页排版美观：

#### Day1 - 抵达东京，初探都市风情

| 时间 | 行程内容 | 备注 |
|------|----------|------|
| 上午 | 抵达东京成田或羽田机场，中文司机接机 | 根据实际航班安排 |
| 中午 | 入住酒店后简单用餐 | 推荐浅草或银座周边日式餐厅 |
| 下午 | 浅草寺参拜、雷门、晴空塔拍照打卡 | 结合历史文化与城市景观 |
| 晚上 | 日本居酒屋或拉面馆 | 可选择家庭套餐，体验日本风味 |
| 住宿 | 东京市中心酒店（推荐上野、浅草区域） | 交通便利，适合家庭 |

---

请根据以上要求，制定完整的 Day1 ~ DayX 行程计划与预算。

不需要任何AI自我提示或免责声明，直接输出内容即可。
`;

      try {
        const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer sk-f364b488cdff4e87951aa571f6208526"
          },
          body: JSON.stringify({
            model: "deepseek-chat",
            messages: [
              { role: "system", content: "你是一位专业中文旅行规划师" },
              { role: "user", content: prompt }
            ],
            temperature: 0.7
          })
        });

        const data = await response.json();
        if (data && data.choices && data.choices.length > 0) {
          output.innerHTML = marked.parse(data.choices[0].message.content.trim());
          paywall.style.display = 'block';
          document.getElementById("pdf-content").scrollIntoView({ behavior: "smooth" });
        } else {
          output.innerText = "⚠️ AI未返回有效内容，请稍后再试。";
        }
      } catch (error) {
        console.error("Error:", error);
        output.innerText = "❌ AI请求出错，请检查网络连接。";
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerText = "🗺️ AI生成旅游行程";
      }
    }

    function unlockPDF() {
      const btn = document.getElementById('unlockButton');
      btn.innerHTML = '<span>✅</span> 已支付，下载行程PDF';
      document.getElementById('pdfButton').style.display = 'inline-block';
      document.getElementById('pdfButton').scrollIntoView({ behavior: "smooth" });
    }

    function exportPDF() {
      const element = document.getElementById("pdf-content");
      const opt = {
        margin: 0.5,
        filename: "旅行行程计划.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
        jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
      };
      html2pdf().set(opt).from(element).save();
    }
   </script>
   <div class="footer">
    &copy; 2025 MYG. All rights reserved.
   </div>
  </div>
  <footer>
   &copy; 2025 MYG. All rights reserved.
  </footer>
 </body>
</html>
